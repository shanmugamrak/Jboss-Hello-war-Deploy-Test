name: Deploy WAR to JBoss

on:
  workflow_dispatch:
env:
  GITHUB_TOKEN: ${{ secrets.Workflow2_PAT_TOKEN_GITHUB }}
  
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        
      - name: list 
        run: |
         cd ${{ github.workspace }}/dist
         ls -la


      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'  
          
      - name: login to JBoss and deploy war file
        env:
          JBOSS_USERNAME: ${{ secrets.JBOSS_USERNAME }} 
          JBOSS_PASSWORD: ${{ secrets.JBOSS_PASSWORD }} 
          JBOSS_ENDPOINT: ${{ vars.JBOSS_ENDPOINT }} 
          WAR_PATH: ${{github.workspace }}/dist/helloworld.war

        run: |  
          chmod 755 ${{github.workspace }}/dist/helloworld.war
          curl -u $JBOSS_USERNAME:$JBOSS_PASSWORD -T $WAR_PATH $JBOSS_ENDPOINT/management-webapp/undeploy?name=$($WAR_PATH)
          sleep 5
          curl -u $JBOSS_USERNAME:$JBOSS_PASSWORD -T $WAR_PATH $JBOSS_ENDPOINT/management-webapp/deploy?name=$($WAR_PATH)          

          
#        run: |  
 #         curl -u -DJBOSS_USERNAME=$JBOSS_USERNAME -DJBOSS_PASSWORD=$JBOSS_PASSWORD -T $WAR_PATH $JBOSS_ENDPOINT/management-webapp/undeploy?name=$($WAR_PATH)
  #        sleep 5
   #       curl -u -DJBOSS_USERNAME=$JBOSS_USERNAME -DJBOSS_PASSWORD=$JBOSS_PASSWORD -T $WAR_PATH $JBOSS_ENDPOINT/management-webapp/deploy?name=$($WAR_PATH)          
          

        #run: |
         # chmod +rx ${{ github.workspace }}/dist/helloworld.war
          #curl -F "file=@${WAR_PATH}" -u "${JBOSS_USERNAME}:${JBOSS_PASSWORD}" "http://${JBOSS_ENDPOINT}:${JBOSS_PORT}/management/domain/servers/server-one/deployment/${APPLICATION_NAME}.war?operation=upload"
          #curl -X POST -u "${JBOSS_USERNAME}:${JBOSS_PASSWORD}" "http://${JBOSS_ENDPOINT}:${JBOSS_PORT}/management/domain/servers/server-one/deployment/${APPLICATION_NAME}.war?operation=redeploy"        
         
