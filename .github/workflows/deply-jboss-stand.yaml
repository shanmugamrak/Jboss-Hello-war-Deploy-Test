name: Deploy WAR to JBoss

on:
  workflow_dispatch:
env:
  GITHUB_TOKEN: ${{ secrets.Workflow2_PAT_TOKEN_GITHUB }}
  
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3


      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'  
          
      - name: login to JBoss and deploy war file
        env:
          JBOSS_ENDPOINT: ${{ secrets.JBOSS_ENDPOINT }}  #${{ vars.JBOSS_ENDPOINT }}
          JBOSS_USERNAME: ${{ secrets.JBOSS_USERNAME }} #jbadmin
          JBOSS_PASSWORD: ${{ secrets.JBOSS_PASSWORD }} #jbadmin@123
          JBOSS_PORT: ${{ secrets.JBOSS_PORT }}
          APPLICATION_NAME: helloworld
          WAR_PATH: ${{github.workspace }}/dist/
          
          
        run: |
          chmod +r ${{ github.workspace }}/dist/helloworld.war
          curl -F "file=@${WAR_PATH}" -u "${JBOSS_USERNAME}:${JBOSS_PASSWORD}" "http://${JBOSS_ENDPOINT}:${JBOSS_PORT}/management/domain/servers/server-one/deployment/${APPLICATION_NAME}.war?operation=upload"
          curl -X POST -u "${JBOSS_USERNAME}:${JBOSS_PASSWORD}" "http://${JBOSS_ENDPOINT}:${JBOSS_PORT}/management/domain/servers/server-one/deployment/${APPLICATION_NAME}.war?operation=redeploy"        
         
